#!/usr/bin/env python3

import psutil
import subprocess
import time
import os

def header(title):
    print("\n" + "="*60)
    print(title)
    print("="*60)

# HOSTNAME
header("SYSTEM INFORMATION")
print("Hostname       :", os.uname().nodename)
print("OS             :", subprocess.getoutput("cat /etc/os-release | grep PRETTY_NAME | cut -d= -f2").replace('"',''))
print("Uptime         :", subprocess.getoutput("uptime -p"))

# CPU
header("CPU STATUS")
print("CPU Cores      :", psutil.cpu_count())
print("CPU Usage (%)  :", psutil.cpu_percent(interval=1))
print("Load Average   :", os.getloadavg())

# MEMORY
header("MEMORY STATUS")
mem = psutil.virtual_memory()
print("Total Memory   :", round(mem.total / (1024**3), 2), "GB")
print("Used Memory    :", round(mem.used / (1024**3), 2), "GB")
print("Free Memory    :", round(mem.available / (1024**3), 2), "GB")
print("Usage (%)      :", mem.percent)

# DISK
header("DISK USAGE")
for part in psutil.disk_partitions():
    try:
        usage = psutil.disk_usage(part.mountpoint)
        print(f"{part.mountpoint}  {usage.percent}% used")
    except:
        pass

# NETWORK
header("NETWORK STATUS")
net = psutil.net_io_counters()
print("Bytes Sent     :", round(net.bytes_sent / (1024**2), 2), "MB")
print("Bytes Received :", round(net.bytes_recv / (1024**2), 2), "MB")

# USERS
header("LOGGED-IN USERS")
users = psutil.users()
for user in users:
    print(user.name, "from", user.host)

# TOP PROCESSES
header("TOP 5 MEMORY CONSUMING PROCESSES")
processes = sorted(psutil.process_iter(['pid','name','memory_percent']),
                   key=lambda p: p.info['memory_percent'],
                   reverse=True)[:5]

for p in processes:
    print(f"PID:{p.info['pid']}  {p.info['name']}  {round(p.info['memory_percent'],2)}%")

print("\nSystem health check completed âœ”")
